<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="photo">

	<select id="photo_list" resultType="vo.PhotoVo">
 		select * from photo
 	</select>
 	
 		<select id="photo_condition_list" parameterType="Map" resultType="vo.PhotoVo"> 
 		select 
		* 
		from
		(
			select 
				* , rank() over(order by p_idx desc) as no
			from photo
				<trim prefix="where"  prefixOverrides="or">
			
				<if test="name!=null">
					mem_name like concat('%', #{name}, '%')
				</if>
				<if test="subject!=null">
					p_subject like concat('%', #{subject}, '%')
				</if>
				<if test="content!=null">
					or	p_content like concat('%', #{content}, '%')
				</if>
					
			</trim>
			
		) b
		where b.no between #{start} and #{end}
	</select>

 
 	<select id="photo_one" parameterType="int" resultType="vo.PhotoVo">
	select * from photo where p_idx = #{ p_idx }
	</select>
 	
 	<insert id="photo_insert"  parameterType="vo.PhotoVo">
	insert into photo(p_subject,p_content,p_filename, p_ip, mem_idx,mem_name) values( #{ p_subject } , #{ p_content } , #{ p_filename} , #{ p_ip } , #{ mem_idx }, #{  mem_name })
	</insert>
  
	<delete id="photo_delete" parameterType="int">
	delete from photo where p_idx = #{ p_idx }
	</delete>
	
	<update id="photo_update" parameterType="vo.PhotoVo">
	update photo set p_subject= #{ p_subject },p_content=#{ p_content },p_modifydate= now() where p_idx=#{ p_idx }
	</update>
	
	<update id="photo_update_filename" parameterType="vo.PhotoVo">
	update photo set p_filename= #{ p_filename },p_modifydate=now() where p_idx=#{ p_idx }
	</update>
	
		<select id="photo_condition_row_total" parameterType="Map" resultType="int">
		select ifnull(count(*),0) from photo	
	</select>
	
</mapper>












